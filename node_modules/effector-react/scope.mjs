function e(e,t,n,r){let u=[g.run({fn:e=>t(e)})];if(r&&u.unshift(r),n){let t=S({node:u}),r=e.graphite.id,o=n.additionalLinks,s=o[r]||[];return o[r]=s,s.push(t),()=>{let e=s.indexOf(t);-1!==e&&s.splice(e,1),x(t)}}{let t=S({node:u,parent:[e],family:{owners:e}});return()=>{x(t)}}}function t(e,t){return t.displayName=e,t}function n(t,n){j.store(t)||w('expect useStore argument to be a store');let r=b.useCallback((r=>e(t,r,n)),[t,n]),u=b.useCallback((()=>K(t,n)),[t,n]);return O(r,u,u)}function r(t,n){let r=j.unit(t),u={};r?u={unit:t}:'@@unitShape'in t?'function'==typeof t['@@unitShape']?u=t['@@unitShape']():w('expect @@unitShape to be a function'):u=t;let o=Array.isArray(u),s=b.useRef({stale:1,justSubscribed:0,scope:n}),[l,a,i,c,f]=b.useMemo((()=>{s.current.stale=1;let e=Array.isArray(u)?[]:{},t=[],r=[],o=[],l=[];for(let s in u){let a=u[s];j.unit(a)||w('expect useUnit argument to be a unit'),j.event(a)||j.effect(a)?(e[s]=n?C(a,{scope:n}):a,o.push(s),l.push(a)):(e[s]=null,t.push(s),r.push(a))}return[e,t,r,o,l]}),[s,n,...Object.keys(u),...Object.values(u)]),p=b.useRef({value:l,storeKeys:a,eventKeys:c,eventValues:f}),d=b.useCallback((t=>{let r=s.current;r.justSubscribed=1;let u=()=>{r.stale||(r.stale=1,t())},o=g.compute({priority:'sampler',batch:1}),l=i.map((t=>e(t,u,n,o)));return()=>{l.forEach((e=>e()))}}),[i,n,p,s]),y=b.useCallback((()=>{let e,t=p.current,u=s.current,d=0,y=t.value,m=t.storeKeys,h=t.eventKeys,b=t.eventValues,v=n!==u.scope;if(u.stale||u.justSubscribed||v){d=!u.justSubscribed||v,e=o?[...l]:{...l},m.length===a.length&&h.length===c.length||(d=1);for(let t=0;t<a.length;t++){let r=K(i[t],n),u=a[t];d||(d=m.includes(u)?y[u]!==r:1),e[u]=r}for(let e=0;e<c.length;e++){let t=f[e],n=c[e];d||(d=h.includes(n)?b[h.indexOf(n)]!==t:1)}}return d&&(t.value=e),t.storeKeys=a,t.eventKeys=c,t.eventValues=f,u.stale=0,u.justSubscribed=!d,u.scope=n,r?t.value.unit:t.value}),[d,i,f,n,p,s]);return O(d,y,y)}function u([t,n],r){let u,o,s,l,a=N;n?(u=n,s=t,l=[]):({fn:u,store:s,keys:l,defaultValue:o,updateFilter:a=N}=t),j.store(s)||w('useStoreMap expects a store'),Array.isArray(l)||w('useStoreMap expects an array as keys'),'function'!=typeof u&&w('useStoreMap expects a function');let i=b.useCallback((t=>e(s,t,r)),[s,r]),c=b.useCallback((()=>K(s,r)),[s,r]),f=b.useRef(),p=b.useRef(),d=b.useRef(l);return R(i,c,c,(e=>{if(f.current!==e||!((e,t)=>{if(!e||!t||e.length!==t.length)return 0;let n=1;for(let r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n})(d.current,l)){let t=u(e,l);void 0===t&&void 0!==o&&(t=o),f.current=e,d.current=l,void 0!==t&&(p.current=t)}return p.current}),((e,t)=>!a(t,e)))}function o(e,t={},n){let{open:u,close:o,set:s}=r({open:e.open,close:e.close,set:e.set},n),l=b.useMemo((()=>({open:u,close:o,set:s})),[e,u]),a=b.useRef({value:null,count:0});M((()=>(l.open(a.current.value),()=>l.close(a.current.value))),[l]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(let r=0;r<n.length;r++){let u=n[r];if(e[u]!==t[u])return 0}return 1}return 0})(a.current.value,t)||(a.current.value=t,a.current.count+=1),M((()=>{l.set(a.current.value)}),[a.current.count])}function s(e){let t=b.useContext(V);return e&&!t&&w('No scope found, consider adding <Provider> to app root'),t}function l(e,t){let n=t?e:e[0];var r;(e=>{if(!e)throw Error('expect first argument be an object')})(B(r=n)||(e=>'function'==typeof e)(r));let u=n.or,o=n.and;if(o){let n=t?o:o[0];if(B(n)&&'and'in n){let n=l(o,t);e=n[0],u={...u,...n[1]}}else e=o}return[e,u]}function a(e,t){let n=t&&B(r=t[0])&&(r.and||r.or)?t:[{and:t}];var r;let u,[[o,s],a]=l(n),i={},c={},f=a;var p;return'string'==typeof o?(c={name:o},B(p=s)&&'sid'in p||(i=s||{})):(e=>B(e)&&('domain'in e||'defaultState'in e||'name'in e))(o)&&(c=o,i=o.defaultState||{},u=o.domain),{hook:e,domain:u,defaultState:i,mainConfig:c,maybeConfig:f}}function i(...e){return(({domain:e,defaultState:n,hook:r,mainConfig:u,maybeConfig:o})=>{function l(e){return r(l,e,s()),null}let a=F({or:o,and:u}),i=`${e?`${e.compositeName.fullName}/`:''}${a.name||'gate'}`,c=$({name:`${i}.set`,sid:a.sid?`${a.sid}|set`:void 0}),f=$({name:`${i}.open`,sid:a.sid?`${a.sid}|open`:void 0}),p=$({name:`${i}.close`,sid:a.sid?`${a.sid}|close`:void 0}),d=A(Boolean(0),{name:`${i}.status`,serialize:'ignore'}).on(f,(()=>Boolean(1))).on(p,(()=>Boolean(0))),y=A(n,{name:`${i}.state`,sid:a.sid}).on(c,((e,t)=>t)).on(f,((e,t)=>t)).reset(p);if(e){let{hooks:t}=e;E({target:[t.store,t.store,t.event,t.event,t.event],params:[d,y,f,p,c]})}return l.open=f,l.close=p,l.status=d,l.state=y,l.set=c,t(`Gate:${i}`,l)})(a(o,e))}function c(e){return t=>{let n=f(e);return t.children(n)}}function f(e){return n(e,s(1))}function p(e){return r(e,s(1))}function d(e,r){return((e,r,o)=>{let s,l,a,i=[];'object'==typeof r&&null!==r?(r.keys&&(i=r.keys),({fn:s,getKey:l,placeholder:a}=r)):s=r,j.store(e)||w('expect useList first argument to be a store'),'function'!=typeof s&&w("expect useList's renderItem to be a function"),Array.isArray(i)||w("expect useList's keys to be an array");let c=b.useMemo((()=>{let n=t(`${e.shortName||'Unknown'}.Item`,(t=>{let{index:n,keys:r,keyVal:s,value:l}=t;if(f.current[1])return f.current[0](l,s);let a=u([{store:e,keys:[n,...r],fn:(e,t)=>e[t[0]]}],o);return f.current[0](a,n)}));return b.memo(n)}),[e,o,!!l]),f=b.useRef([s,l]);f.current=[s,l];let p=b.useMemo((()=>i),i);if(l){let t=n(e,o);return 0===t.length&&a?a:t.map((e=>{let t=f.current[1](e);return b.createElement(c,{keyVal:t,key:t,keys:p,value:e})}))}{let t=u([{store:e,keys:[e],fn:e=>e.length}],o);return 0===t&&a?a:Array.from({length:t},((e,t)=>b.createElement(c,{index:t,key:t,keys:p})))}})(e,r,s(1))}function y(e,t){let n=s(1);return u(t?[e,t]:[{store:e.store,keys:e.keys,fn:e.fn,updateFilter:e.updateFilter}],n)}function m(e){return((e,t)=>{if(!t)return e;let n=j.unit(e)||'object'!=typeof e?{event:e}:e;return b.useMemo((()=>{if(j.unit(e))return C(e,{scope:t});let n=Array.isArray(e)?[]:{};for(let r in e)n[r]=C(e[r],{scope:t});return n}),[t,...Object.keys(n),...Object.values(n)])})(e,s(1))}function h(e,t={}){return o(e,t,s(1))}import b from'react';import v from'use-sync-external-store/shim/with-selector.js';import k from'use-sync-external-store/shim/index.js';import{step as g,createNode as S,clearNode as x,is as j,scopeBind as C,createEvent as $,createStore as A,launch as E}from'effector/effector.mjs';let w=e=>{throw Error(e)},M='undefined'!=typeof window?b.useLayoutEffect:b.useEffect;const{useSyncExternalStore:O}=k,{useSyncExternalStoreWithSelector:R}=v,K=(e,t)=>t?t.getState(e):e.getState(),N=(e,t)=>e!==t,V=b.createContext(null);let{Provider:L}=V,B=e=>'object'==typeof e&&null!==e,F=(e,t={})=>(B(e)&&(F(e.or,t),(e=>{for(let u in e)r=u,(e=>void 0===e)(n=e[u])||'or'===r||'and'===r||(t[r]=n);var n,r})(e),F(e.and,t)),t),U=e=>console.error(`${e} is deprecated`),I=(e,t,n)=>(U('createContextComponent'),r=>{let u=b.useContext(t),o=f(e);return n(r,o,u)}),P=()=>w('not implemented'),z=(e,t)=>(U('createReactState'),G(t)(e)),G=e=>n=>{let r=e;return'function'!=typeof e&&(r=n,n=e),t(`Connect(${r.displayName||r.name||'Unknown'})`,(e=>b.createElement(r,{...e,...f(n)})))};export{L as Provider,G as connect,P as createComponent,I as createContextComponent,i as createGate,z as createReactState,c as createStoreConsumer,m as useEvent,h as useGate,d as useList,f as useStore,y as useStoreMap,p as useUnit};
//# sourceMappingURL=scope.mjs.map
